import React from 'react';
// @ts-ignore
import DG from '2gis-maps';

interface RoutestopDisplay {
    id: string,
    name: string,
    enabled: boolean,
    coords: [number, number],
    time: string,
}

interface RouteDisplay {
    stations: RoutestopDisplay[],
    routePoints: [number, number][]
}

export class RouteMap extends React.Component {
    public componentDidMount() {
        let map: any;

        DG.then(function () {
            map = DG.map('map', {
                center: [54.98, 65],
                zoom: 5,
                zoomControl: false,
                fullscreenControl: false
            });

            const route: RouteDisplay = {
                stations: [
                    {id: '1', name:'Новосиб Гл', time:'', enabled: true, coords: [55.0358039, 82.8958949]},
                    {id: '2', name:'Чулымская', time:'', enabled: false, coords: [55.0973892, 80.9714896]},
                    {id: '3', name:'Барабинск', time:'', enabled: true, coords: [55.3556508, 78.3507305]},
                    {id: '4', name:'Оз Карачин', time:'', enabled: false, coords: [55.3341081, 76.9431221]},
                    {id: '5', name:'Татарская', time:'', enabled: false, coords: [55.2147545, 75.9566865]},
                    {id: '6', name:'Омск Пасс', time:'', enabled: true, coords: [54.9396614, 73.3859985]},
                    {id: '7', name:'Ишим', time:'', enabled: true, coords: [56.1126631, 69.5128538]},
                    {id: '8', name:'Тюмень', time:'', enabled: true, coords: [57.1451952, 65.5225611]},
                    {id: '9', name:'Екатеринб П', time:'', enabled: true, coords: [56.8598705, 60.5920263]},
                    {id: '10', name:'Дружинино', time:'', enabled: false, coords: [56.7909452, 59.5176265]},
                    {id: '11', name:'Красноуфим', time:'', enabled: false, coords: [56.5973882, 57.7612075]},
                    {id: '12', name:'Чернушка', time:'', enabled: false, coords: [56.4976769, 56.0791166]},
                    {id: '13', name:'Янаул', time:'', enabled: false, coords: [56.2716497, 54.9294332]},
                    {id: '14', name:'Сарапул', time:'', enabled: true, coords: [56.4512561, 53.7808535]},
                    {id: '15', name:'Агрыз', time:'', enabled: false, coords: [56.5249233, 53.0135636]},
                    {id: '16', name:'Можга', time:'', enabled: true, coords: [56.4451269, 52.2044173]},
                    {id: '17', name:'Вят Поляны', time:'', enabled: false, coords: [56.2292327, 51.0338763]},
                    {id: '18', name:'Казань', time:'', enabled: true, coords: [55.8425026, 49.080706]},
                    {id: '19', name:'Новосиб Гл', time:'', enabled: true, coords: [55.0358039, 82.8958949]},
                    {id: '20', name:'Чулымская', time:'', enabled: false, coords: [55.0973892, 80.9714896]},
                    {id: '21', name:'Барабинск', time:'', enabled: true, coords: [55.3556508, 78.3507305]},
                    {id: '22', name:'Оз Карачин', time:'', enabled: false, coords: [55.3341081, 76.9431221]},
                    {id: '23', name:'Татарская', time:'', enabled: false, coords: [55.2147545, 75.9566865]},
                    {id: '24', name:'Омск Пасс', time:'', enabled: true, coords: [54.9396614, 73.3859985]},
                    {id: '25', name:'Ишим', time:'', enabled: true, coords: [56.1126631, 69.5128538]},
                    {id: '26', name:'Тюмень', time:'', enabled: true, coords: [57.1451952, 65.5225611]},
                    {id: '27', name:'Екатеринб П', time:'', enabled: true, coords: [56.8598705, 60.5920263]},
                    {id: '28', name:'Дружинино', time:'', enabled: false, coords: [56.7909452, 59.5176265]},
                    {id: '29', name:'Красноуфим', time:'', enabled: false, coords: [56.5973882, 57.7612075]},
                    {id: '30', name:'Чернушка', time:'', enabled: false, coords: [56.4976769, 56.0791166]},
                    {id: '31', name:'Янаул', time:'', enabled: false, coords: [56.2716497, 54.9294332]},
                    {id: '32', name:'Сарапул', time:'', enabled: true, coords: [56.4512561, 53.7808535]},
                    {id: '33', name:'Агрыз', time:'', enabled: false, coords: [56.5249233, 53.0135636]},
                    {id: '34', name:'Можга', time:'', enabled: true, coords: [56.4451269, 52.2044173]},
                    {id: '35', name:'Вят Поляны', time:'', enabled: false, coords: [56.2292327, 51.0338763]},
                    {id: '36', name:'Казань', time:'', enabled: true, coords: [55.8425026, 49.080706]}
                ],
                routePoints: [
                    [55.8436775,49.075365],
                    [55.8515918,49.1510568],
                    [56.0081776,49.5570807],
                    [56.0770154,50.0701518],
                    [56.2255173,51.0313162],
                    [56.2493676,51.0560354],
                    [56.2581408,51.1061605],
                    [56.2447895,51.1679586],
                    [56.2558523,51.2675222],
                    [56.2131093,51.3217672],
                    [56.2428818,51.4261374],
                    [56.3491866,51.5943655],
                    [56.4267277,51.945928],
                    [56.4441907,52.2137198],
                    [56.4540575,52.3325094],
                    [56.5079004,52.4698385],
                    [56.5733945,52.6840719],
                    [56.5211598,52.896932],
                    [56.5204022,52.9971823],
                    [56.5548556,53.113912],
                    [56.5060058,53.2162222],
                    [56.5113104,53.2430014],
                    [56.4859175,53.5341391],
                    [56.4563341,53.6790213],
                    [56.4529192,53.7820181],
                    [56.4252088,53.8465628],
                    [56.4221709,53.9056143],
                    [56.4001383,53.9440664],
                    [56.2562337,54.1775259],
                    [56.2535637,54.2976889],
                    [56.2428818,54.3663534],
                    [56.2337235,54.4961294],
                    [56.2733937,54.9458822],
                    [56.4451206,55.7222668],
                    [56.5088287,55.9598461],
                    [56.4841924,56.0140911],
                    [56.5031448,56.1871258],
                    [56.452331,56.3306347],
                    [56.4504337,56.5380016],
                    [56.4785048,56.6581646],
                    [56.4762296,56.8744579],
                    [56.4580225,56.9561688],
                    [56.4811591,57.02552],
                    [56.4665581,57.0814816],
                    [56.5171635,57.2311703],
                    [56.5342063,57.2788921],
                    [56.5256858,57.2891918],
                    [56.530041,57.3315922],
                    [56.5282895,57.3797432],
                    [56.5423462,57.4232594],
                    [56.5425828,57.4965588],
                    [56.5614588,57.5136391],
                    [56.5594723,57.5567261],
                    [56.5684107,57.591745],
                    [56.5554044,57.6332012],
                    [56.5792853,57.6619545],
                    [56.5750777,57.6750866],
                    [56.5589047,57.7023808],
                    [56.5527552,57.7204052],
                    [56.5729973,57.7552525],
                    [56.6061747,57.7634922],
                    [56.6231774,57.7518192],
                    [56.6357356,57.760574],
                    [56.7179686,58.0695644],
                    [56.7868606,58.1835476],
                    [56.7992702,58.2638851],
                    [56.8469905,58.298904],
                    [56.8484925,58.4197537],
                    [56.8398551,58.4382931],
                    [56.8165618,58.6216274],
                    [56.841733,58.7568966],
                    [56.8590049,58.7788693],
                    [56.8533736,58.8482205],
                    [56.86426,58.8921658],
                    [56.8413574,59.0514675],
                    [56.8541245,59.0830532],
                    [56.8533736,59.1386715],
                    [56.8293373,59.1750637],
                    [56.8822718,59.2375485],
                    [56.8698896,59.2766873],
                    [56.8261718,59.3595165],
                    [56.7919657,59.4141048],
                    [56.7974182,59.5040554],
                    [56.7840676,59.5284313],
                    [56.7629977,59.5572704],
                    [56.7613041,59.5867962],
                    [56.7833153,59.6043056],
                    [56.8015541,59.6300548],
                    [56.7983582,59.6609539],
                    [56.8162139,59.6867031],
                    [56.816026,59.7151989],
                    [56.7737223,59.7309917],
                    [56.765444,59.7577709],
                    [56.7961022,59.798283],
                    [56.8246689,59.8559612],
                    [56.8222265,59.8720974],
                    [56.8132072,59.9181026],
                    [56.8218508,59.9819607],
                    [56.8126435,60.0018734],
                    [56.8124555,60.0437587],
                    [56.8246689,60.067448],
                    [56.8226023,60.0883907],
                    [56.8376295,60.2373928],
                    [56.8477694,60.2538723],
                    [56.853777,60.3218502],
                    [56.8886768,60.4433864],
                    [56.8585335,60.5530992],
                    [56.8592842,60.613524],
                    [56.8406041,60.6202188],
                    [56.8357213,60.6329217],
                    [56.8094184,60.7201257],
                    [56.7861061,60.7338586],
                    [56.7887389,60.7668176],
                    [56.7740683,60.79497],
                    [56.7721871,60.8286157],
                    [56.7533693,60.8787408],
                    [56.7721871,60.9453454],
                    [56.7484752,60.9817376],
                    [56.75224,61.0785546],
                    [56.7473457,61.2330499],
                    [56.7319056,61.3113275],
                    [56.7270086,61.3360467],
                    [56.7311523,61.3497796],
                    [56.7300222,61.3765588],
                    [56.71872,61.3964715],
                    [56.7420742,61.5468469],
                    [56.7383083,61.6024652],
                    [56.7736921,61.7542138],
                    [56.7676717,61.9052758],
                    [56.7718108,61.9217553],
                    [56.7838493,62.137362],
                    [56.8146805,62.4504724],
                    [56.8116737,62.5314965],
                    [56.8507432,62.6084008],
                    [56.8593781,62.6859918],
                    [56.8522451,62.6983514],
                    [56.8507432,62.7189507],
                    [56.8428575,62.7354302],
                    [56.8563749,62.8089013],
                    [56.8668851,62.8425469],
                    [56.8856459,62.8507867],
                    [56.9055221,62.9592767],
                    [56.9141443,63.0856194],
                    [56.9459918,63.142611],
                    [56.953107,63.2236352],
                    [56.9733215,63.2600274],
                    [57.0309102,63.4673944],
                    [57.0645247,63.6569085],
                    [57.0604179,63.7139001],
                    [57.066018,63.836123],
                    [57.0783352,63.8835015],
                    [57.077962,64.0345635],
                    [57.0731102,64.0867486],
                    [57.0816937,64.116961],
                    [57.0805742,64.1643395],
                    [57.0641514,64.1959252],
                    [57.066018,64.2213311],
                    [57.072737,64.2460504],
                    [57.076096,64.3071618],
                    [57.0690043,64.343554],
                    [57.0690043,64.5996728],
                    [57.0663913,64.6216455],
                    [57.1063136,64.9272027],
                    [57.15178,65.4730859],
                    [57.1435853,65.5321374],
                    [57.0943787,65.6571069],
                    [57.0704974,65.7051721],
                    [56.964713,65.7807031],
                    [56.7661664,66.084887],
                    [56.6663088,66.2744012],
                    [56.6500805,66.3616052],
                    [56.5605106,66.4330163],
                    [56.5283347,66.4886346],
                    [56.5025742,66.5799584],
                    [56.4912037,66.7873254],
                    [56.4756585,66.939074],
                    [56.4809673,67.0544305],
                    [56.4730038,67.3764672],
                    [56.4688318,67.4018731],
                    [56.4559335,67.8790917],
                    [56.4236687,68.0177941],
                    [56.4046766,68.2066216],
                    [56.3796476,68.496727],
                    [56.3617746,68.6107102],
                    [56.314961,68.8077774],
                    [56.1604122,69.3982926],
                    [56.1382282,69.4182053],
                    [56.1240618,69.4701509],
                    [56.1049203,69.5422487],
                    [56.073891,69.5704012],
                    [56.0807886,69.6713381],
                    [56.0363159,69.7619753],
                    [55.8894998,70.2900057],
                    [55.8821829,70.3497438],
                    [55.8571409,70.4472475],
                    [55.7915701,70.7287722],
                    [55.7583569,70.7981234],
                    [55.6775231,71.0391359],
                    [55.6170787,71.1840181],
                    [55.5891498,71.2822084],
                    [55.3905566,71.9020137],
                    [55.2821378,72.2857601],
                    [54.9393754,73.3111007],
                    [54.9283296,73.3668906],
                    [54.9305982,73.3804519],
                    [54.9470662,73.3902366],
                    [54.9497281,73.397618],
                    [54.9487422,73.4043128],
                    [54.9294146,73.4269721],
                    [55.0452411,74.6035392],
                    [55.2052539,75.8728956],
                    [55.270244,76.4510511],
                    [55.3671398,77.1335767],
                    [55.3573828,77.3560499],
                    [55.3448903,77.9218458],
                    [55.3331751,78.1340192],
                    [55.3468425,78.1985639],
                    [55.3554311,78.3489393],
                    [55.3569924,78.5357069],
                    [55.3421571,78.7293409],
                    [55.3441094,78.9291547],
                    [55.3128604,79.5800947],
                    [55.2741556,79.8904585],
                    [55.1436897,80.6553815],
                    [55.0975346,80.9739741],
                    [55.0923285,81.0417804],
                    [55.0871217,81.0493335],
                    [55.079556,81.0943088],
                    [55.0857463,81.1780795],
                    [55.1034274,81.3859614],
                    [55.0802439,81.4566859],
                    [55.0833882,81.6334971],
                    [55.0216357,82.1277102],
                    [55.0236038,82.1496829],
                    [55.0049029,82.24341],
                    [54.9922994,82.7292117],
                    [54.9905505,82.7425972],
                    [54.9966323,82.881647],
                    [54.9987986,82.8900584],
                    [54.9984047,82.9012164],
                    [55.012089,82.9214725],
                    [55.0191754,82.9223308],
                    [55.0234561,82.907399],
                    [55.0358039,82.8958949],
                ]
            };

            const polyline = DG.polyline(route.routePoints, {color: '#EB5757', weight: 5}).addTo(map);

            route.stations.forEach((station, i) => {
                const color = station.enabled ? '#EB5757' : '#394A58';
                const radius = station.enabled ? 5000 : 3000;
                const fontSize = station.enabled ? 18 : 14;
                const className = station.enabled ? 'my-div-icon-active' : 'my-div-icon-inactive';
                const height = station.enabled ? 30 : 20;
                const width = station.name.length * fontSize - 5;

                DG.circle(station.coords, radius, {color, weight: 3, label: station.name, fill:true, fillColor: '#ffffff', fillOpacity: 1}).addTo(map);

                const label = DG.divIcon({
                    className,
                    iconSize: [width, height],
                    iconAnchor: [50, 40],
                    html: '<span style="color:'+ color +'; font-size:'+ fontSize + 'px; text-align: center; font-family: RussoOne-Regular; line-height: ' + height + 'px">'+station.name+'<br/>'+station.time+'</span>'
                });
                DG.marker(station.coords, {
                    icon: label
                }).addTo(map);
            });

            map.fitBounds(polyline.getBounds());
        });
    }

    public render() {
        return (
            <div id="map" style={{width:"100%", height:"100vh"}}/>
        );
    }
}